<html lang="en">
	<head>
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='flairs.css') }}?version=1.0">

		{% if session.get('updated') %}
			<meta http-equiv="refresh" content="3;url=https://competitiveoverwatch.reddit.com" />
		{% endif %}
	</head>
	<script>
		var nowsetting=1
		function setFlair(ev, id) {
			if (nowsetting == 1) {
				parent.document.getElementById('flair1').className = ev.target.className;
				parent.document.getElementById('flair1_id').value = id;
				nowsetting = 2;
			} else {
				parent.document.getElementById('flair2').className = ev.target.className;
				parent.document.getElementById('flair2_id').value = id;
				nowsetting = 1;
			}
		}
		
		function setSetting(num) {
			nowsetting=num;
		}
	</script>
	<body>
		{% set categories = flairdata['categories'] %}
		{% set ranks = flairdata['ranks'] %}
		{% set flairs = flairdata['flairs'] %}
		
		{% if session.get('redditname') %}
			<form action="/redditflair/updateflair" method="get">
				{% if user %}
					{% if user.flair1 %}
						{% set flair = flairs[user.flair1] %}
						<div id="flair1" class="flair flair-{{flair['sheet']}}-c{{flair['col']}}-r{{flair['row']}}" onclick="setSetting(1)"></div>
						<input type="hidden" name="flair1_id" id="flair1_id" value="{{user.flair1}}">
					{% else %}
						<div id="flair1" onclick="setSetting(1)"></div>
						<input type="hidden" name="flair1_id" id="flair1_id">
					{% endif %}
					{% if user.flair2 %}
						{% set flair = flairs[user.flair2] %}
						<div id="flair2" class="flair flair-{{flair['sheet']}}-c{{flair['col']}}-r{{flair['row']}}" onclick="setSetting(2)"></div>
						<input type="hidden" name="flair2_id" id="flair2_id" value="{{user.flair2}}">
					{% else %}
						<div id="flair2" onclick="setSetting(2)"></div>
						<input type="hidden" name="flair2_id" id="flair2_id">
					{% endif %}			
				{% endif %}	
				<input type="text" name="customflairtext" placeholder="Custom Flair Text">
				
				<input type="submit" value="Update Flair">
				
				<!-- Special category -->
				{% if user and specials %}
					<h1>Special</h1>
					{% for special in specials %}
						{% set flair = flairs[special.specialid] %}
						<div class="flair flair-{{flair['sheet']}}-c{{flair['col']}}-r{{flair['row']}}" onclick="setFlair(event, '{{'blizzard'}}')"></div>{{flair['name']}} - {{special.text}}<br>
					{% endfor %}
				{% endif %}	
					
				<!-- Rank category -->
				<h1>{{ranks['title']}}</h1>
				
				{% set rankNum = 0 %}
				{% if user %}
					{% set rankNum = user.rank %}
				{% endif %}	
				{% if rankNum == 0 %}
					<a href="/redditflair/rankverification">Verify your rank</a>
				{% else %}
					<input type="checkbox" name="showsr" value="1" checked> Display my SR number. <br>
				{% endif %}
				{% for item in ranks['items'] %}
					{% set flair = flairs[item] %}
					{% if loop.index <= rankNum %}
						<div class="flair flair-{{flair['sheet']}}-c{{flair['col']}}-r{{flair['row']}}" onclick="setFlair(event, '{{item}}')"></div>{{flair['name']}}<br>
					{% endif %}
				{% endfor %}
			
				<!-- Other categories -->
				{% for category in categories %}
					<!-- special case for rank flairs -->
					<h1>{{category['title']}}</h1>
					{% for item in category['items'] %}
						{% set flair = flairs[item] %}
						<div class="flair flair-{{flair['sheet']}}-c{{flair['col']}}-r{{flair['row']}}" onclick="setFlair(event, '{{item}}')"></div>{{flair['name']}}<br>
					{% endfor %}
				{% endfor %}
			</form>
		{% else %}
			<a href="{{redditLink}}">Sign in with Reddit</a>
		{% endif %}
		
		
	</body>
</html>